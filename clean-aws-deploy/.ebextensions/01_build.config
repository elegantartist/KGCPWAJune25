files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/50_build_app.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      set -e
      cd /var/app/staging
      echo "Current directory: $(pwd)"
      echo "Installing dependencies..."
      npm ci --only=dev
      npm ci --production=false
      echo "Building application..."
      npm run build
      echo "Build complete. Checking dist directory..."
      ls -la dist/ || echo "No dist directory found"
      if [ ! -f "dist/index.js" ]; then
        echo "ERROR: dist/index.js not found after build!"
        echo "Contents of current directory:"
        ls -la
        echo "Package.json build script:"
        cat package.json | grep -A 1 -B 1 "build"
        exit 1
      fi
      echo "Build verification successful - dist/index.js exists"